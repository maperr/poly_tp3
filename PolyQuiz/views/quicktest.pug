extends layout

block head
	link(href='/css/question.css', rel='stylesheet')
	script.
		$(document).ready(function() 
		{	
			var currentAnswer;
			var correctQuestion = 0;
			var questionNumber = 0;
			
			getNewQuestion();

			$('#next.quiz-navig-btn').on('click', function() {
				var selectedAnswer = $('input[name=answer]:checked', '#answer').val();
				if(selectedAnswer == null) {
					return;
				}

				if(selectedAnswer == currentAnswer) {
					correctQuestion++;
					saveResult(1);
				} else {
					saveResult(0);
				}

				questionNumber++
				getNewQuestion();
			});

			function getNewQuestion() {
				displayStatistics(0);
				
				$('#answer').trigger("reset");

			 	$('#questionProgress').text(correctQuestion + '/' + questionNumber);

			 	var questionTitleNumber = questionNumber + 1;
			 	$('#questionTitle').text('Question ' + questionTitleNumber);

			    $.ajax({
					url: "api/quicktest",
					type: "get", 
					success: function(response) {
						$('#domain').text(response.domain);
						$('#askedQuestion').text(response.question);
						$('#answer1').text(response.answers[0]);
						$('#answer2').text(response.answers[1]);
						$('#answer3').text(response.answers[2]);
						currentAnswer = response.correctanswerindex;
					},
					error: function(error) {
						alert("AJAX request failed.");
					}
				});
			}

			function saveResult(success) {
				if(window.localStorage['stats.quicktests.total'] == null) {
					window.localStorage['stats.quicktests.total'] = 0;
					window.localStorage['stats.quicktests.correct'] = 0;
				}

				var total = window.localStorage['stats.quicktests.total'];
				window.localStorage['stats.quicktests.total'] = ++total;

				if(success) {
					var correct = window.localStorage['stats.quicktests.correct'];
					window.localStorage['stats.quicktests.correct'] = ++correct;
				}
			}
		});

block content
	article(id='main-wrapper')
		h1 Test Rapide
		
		section#results
			div#results-content
				h1 Resultats
				p#questionProgress

		section#question
			h1#questionTitle
			label Domaine : 
			span#domain domain
			p#askedQuestion question
			form#answer
				input(name='answer', type='radio', value='0', required='')
				span#answer1
				br
				input(name='answer', type='radio', value='1')
				span#answer2
				br
				input(name='answer', type='radio', value='2')
				span#answer3
				br
				// <input type="submit" value="Suivant"><br>	
			div#clear
			section#quiz-navig
				div#prev.quiz-navig-btn
					a(href='/mypage') 
						div Tableau de bord
				div#next.quiz-navig-btn
					a 
						div Suivant
				div#closer
		section#statistics
			div#statistics-content
				h1 Statistiques
				h1 Tests passés
				table
					tr
						td Total
						td#stats-quicktests
				h1 Examens passés
				table
					tr
						td CSS
						td#stats-exams-css
					tr
						td HTML
						td#stats-exams-html
					tr
						td JS
						td#stats-exams-js
					tr.total
						td Moyenne totale
						td#stats-exams-average